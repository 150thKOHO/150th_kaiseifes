<template>
  <main>
    <!-- 背景 -->
    <div id="background"></div>
    <!-- タイトル -->
    <div id="title">
      <div class="container">
        <div id="title-background">
          <p>開成の150年</p>
        </div>
      </div>
    </div>
    <!-- 創立 -->
    <section>
      <div class="container">
        <era-title id="0">共立学校</era-title>
        <p>明治4年（1871）開成の前身である共立学校が佐野鼎とその同志によって創立。文久元年（1861）に遣欧使節に随行し、欧米諸国を歴訪した佐野鼎は近代化の為には教育が重要と考えて共立学校の創立に至る。</p>
        <p>明治5年（1872）3月に建学の精神ともいえる「学範」が制定された。その中には文明開花の担い手と成りうる学問・人格ともに優れた人材を育成するという佐野の願いが記されている。佐野の主旨に賛同して学校設立に参加した人々は社中と呼ばれた。佐野が加賀藩出身であったためか、旧加賀藩主前田慶寧をはじめ、加賀藩ゆかりの人が多かった。</p>
        <p>同年11月の生徒人数は109名、うち男子99名、女子10名であった。校舎はベランダをもった白壁造り。文明開花を象徴とする擬洋風雨建築となっていた。教育の内容として「共立学校規則」より学科は英学・漢学・筆学・算学の四科が設置され、英学は外国人教師が担当した。また、授業時間は6時間。授業は10の等級が設けられ各種の試験があったようだ。英学の特徴に正則英語（外国で通じる英語）の授業があった。当時の和訳を重視した変則英語に対して外国人に対して通用する発音・会話・作文など佐野の理念に沿った教育がされていた。</p>
      </div>
    </section>
    <!-- 危機と再興 -->
    <section>
      <div class="container">
        <era-title id="1">再興と進歩</era-title>
        <p>明治初期の東京は教育制度が整わないことより私立学校が乱立し、共立学校の生徒数は減少していた。また外国人教師を雇う教育スタイルもあり、学校の資金を削ることになり経営難になっていた。そんななか、明治10年（1877）、佐野は東京で流行したコレラにかかり急逝する。このことより共立学校は一時廃校同然となっていた。</p>
        <p>この状況を打開したのが初代校長の高橋是清である。高橋が校長になったのは明治11年（1878）、25歳の時であった。高橋は佐野の掲げた正則英語の教授を設けるという目標に共感していた。高橋の教育方針は東京大学予備門への入学を目指す生徒に、東京予備門の教員を呼んで教授をしてもらうというものであった。そして明治13年1月に制定された「改正共立学校諸規則」には、「本校ハ専ら他日東京大学予備門二入ラント欲スル者ノ為メ二必要ナル学科ヲ教授スル所トス」と明記されていた。そして「学問の利益は社会の利益を興さんとす」というところであり、近代日本の発展に先駆的な役割を果たす人材を輩出した。</p>
        <p>明治19年（1896）4月、最初の運動会が飛鳥山で開催された。この時、校旗の代用としてイギリスのリットン卿の格言「ペンは剣に優れり」を使用した。これが図案化され「ペンと剣」の校章が定められたのであった。</p>
      </div>
    </section>
    <!-- 戦前の発展 -->
    <section>
      <div class="container">
        <era-title id="2">開成の名へ</era-title>
        <p>明治23年（1890）に政府より中学校令が改正された。各府県に中学校を設立し、地方における教育の振興を図ろうというものだった。これにより地方から上京する生徒が減り、学校経営はなおのこと厳しさを増していた。その影響を受けて明治28年（1895）1月、開成は東京府に対し、私立から府立に移管する願い出をした。それにあたって、「共立」学校では校名としてそぐなわないため、校名を変えることとなった。</p>
        <p>新たな校名は「易経」繋辞伝野中の言葉「開物成務」という言葉に基づいて「開成」となった。「開物成務」とは人知を開発し事物を成し遂げるという意味であり、佐野の近代化の人材という理念に沿った言葉である。その「開成」の名をとって東京府開成尋常中学校と改称した。</p>
        <p>東京府開成尋常中学校としては6年間しかなかったが、校史に残る重要な時期であった。明治28年4月には制服を定めた。そして5月には校旗を新たに制定した。11月には初めての一泊の修学旅行を鎌倉方面にて行った。まさしく開成の基礎となった時代だった。明治32年（1899）には中学校令により東京府開成中学校となった。</p>
      </div>
    </section>
    <!-- 戦争・終戦 -->
    <section>
      <div class="container">
        <era-title id="3">戦禍と開成</era-title>
        <p>大正14年（1925）から各中学校に配属将校が派遣され、軍事教練が開始された。昭和12年（1937）には日中戦争が勃発し、その長期化は国民生活にも大きな影響を与えた。校庭での防空演習など、学校生活にも戦時色が次第に色濃くなっていった。</p>
        <p>昭和20（1945）年8月、日本は終戦を迎え、9月から新学期が開始された。授業再開後、地方に疎開していた生徒、招集されていた教職員が、続々と学校に戻ってきた。占領軍の指示により、軍事教練はもとより柔道・剣道は禁止され、修身・日本歴史・地理の授業も停止された。軍国主義の雰囲気は一掃されていったが、食糧・物資の欠乏は著しかった。そんな中、昭和21年（1946）には運動会とボートレースが復活した。生活も学習環境も厳しかったが、戦争中に比べれば前途は明るかった。</p>
        <p>同年、民主化政策の一環として学制改革が行われた。いわゆる6・3・3制を導入し3年制の新制中学校が生まれ、義務教育の一部となった。昭和26年（1951）、日本は講和条約を結び、国際社会への復帰を果たす。開成にとっても、創立80周年にあたるこの年は新たなる出発の年であった。3月、私立学校法の施行に伴い、財団法人開成学園から学校法人開成学園に改組した。開成は戦争を経て新たな未来へ向けて出発をしたのである。</p>
      </div>
    </section>
    <!-- 戦後から現在 -->
    <section>
      <div class="container">
        <era-title id="4">これからの「開成」</era-title>
      </div>
    </section>
  </main>
</template>

<script>
/**
 * observer で監視する要素と observer の option、intersectionRatio ごとに動かす callback を渡す
 *
 *  vals = {
 *    onDisplay,
 *    oHidden,
 *    targets,
 *    opts
 *  }
 */
/* eslint-disable require-await */
const aniOnLoaded = async (vals) => {
  const observerCallback = (entries) => {
    entries.forEach((entry) => {
      const classList = entry.target.classList
      if (entry.intersectionRatio > 0) {
        classList.add(vals.className)
        observer.unobserve(entry.target)
      } else {
        classList.remove(vals.className)
      }
    })
  }
  const observer = new IntersectionObserver(observerCallback, vals.opts)
  vals.targets.forEach((elem) => {
    observer.observe(elem)
  })
}
/**
 *  vals = {
 *    paths,
 *    className,
 *    target,
 *    observerTargets,
 *    opts
 *  }
 */
const switchImgs = async (vals) => {
  const backgroundDom = vals.target
  const observerCallback = (entries) => {
    entries.forEach((entry) => {
      const id = Number(entry.target.id)
      const positionY = entry.target.getBoundingClientRect().y
      const viewHeight = document.documentElement.clientHeight
      const toBottom = positionY < 0
      const toTop = positionY < viewHeight / 2
      if (toBottom) {
        backgroundDom.style.backgroundImage = `url("../history/${vals.paths[id]}")`
      } else if (toTop) {
        backgroundDom.style.backgroundImage = `url("../history/${vals.paths[id - 1]}")`
      }
    })
  }
  const observer = new IntersectionObserver(observerCallback, vals.opts)
  vals.observeTargets.forEach((elem) => {
    observer.observe(elem)
  })
}
export default {
  data() {
    const imgPaths = [
      'establish.jpg',
      'kyouryu.jpg',
      '100th.jpg',
      'latest.jpg',
      'future.jpg',
    ]
    return {
      imgPaths,
    }
  },
  mounted() {
    const titleBorders = document.getElementsByClassName('era-title-border')
    // switch images
    const imgsObserverOpts = {
      rootMargin: '0px',
      threshold: 0,
    }
    const backgroundDom = document.getElementById('background')
    const switchImgAniClassName = 'switch-img-animation'
    switchImgs({
      paths: this.$data.imgPaths,
      className: switchImgAniClassName,
      target: backgroundDom,
      observeTargets: titleBorders,
      opts: imgsObserverOpts,
    })
    // border streaching animation
    const borderObserverOpts = {
      rootMargin: '100px',
      threshold: 1.0,
    }
    const borderAniClassName = 'era-title-border-animation'
    aniOnLoaded({
      className: borderAniClassName,
      targets: titleBorders,
      opts: borderObserverOpts,
    })
    // fade-in animation
    const fadeinObserverOpts = {
      rootMargin: '100px',
      threshold: 0,
    }
    const fadeinAniTags = ['h2', 'p']
    const fadeinAniElems = document.querySelectorAll(fadeinAniTags)
    const fadeinAniClassName = 'fadein-animation'
    aniOnLoaded({
      className: fadeinAniClassName,
      targets: fadeinAniElems,
      opts: fadeinObserverOpts,
    })
  },
}
</script>

<style scope>
main {
  padding-bottom: 40px;
  color: white;
  font-weight: 600;
}

section {
  padding: 5em 0;
  margin-bottom: 100vh;
  background-color: black;
}

.container {
  padding: 0 16px;
  margin: 0 auto;
  font-family: 'Shippori Mincho';
  color: white;
  max-width: 1000px;
}

.container p {
  max-width: 666px;
}

#title {
  padding-bottom: 45px;
  background-color: black;
}

#title-background {
  height: 335px;
  overflow: hidden;
  background-image: url(/icon_large.svg);
  /* mobile */
  background-size: 500px;
  background-clip: margin-box;
  background-position: left 18px top 23px;
}

@media screen and (min-width: 532px) {
  #title-background {
    background-position: right 18px top 23px;
    background-clip: content-box;
  }
}

#title-background p {
  position: absolute;
  top: 295px;
  font-size: 45px;
  font-weight: 700;
  letter-spacing: -0.025em;
}

#background {
  margin: 0px;
  padding: 0px;
  width: 100vw;
  height: 100vh;
  background-position: center;
  background-size: cover;
  position: fixed;
  top: 0px;
  z-index: -1;
}

.era-title-border-animation {
  animation-name: era-title-border;
  animation-fill-mode: forwards;
  animation-duration: 0.7s;
  animation-timing-function: ease-out;
}

@keyframes era-title-border {
  0% {
    width: 0px;
  }
  100% {
    width: 100px;
  }
}

.fadein-animation {
  animation-name: fadein;
  animation-fill-mode: forwards;
  animation-duration: 0.7s;
  animation-timing-function: ease-out;
}

@keyframes fadein {
  0% {
    transform: translateY(100px);
    opacity: 0;
  }
  100% {
    transform: translateY(0px);
    opacity: 1;
  }
}
</style>