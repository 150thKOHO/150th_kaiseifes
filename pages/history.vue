<template>
  <main>
    <div id="title">
      <div id="title-background">
        <p>開成の150年</p>
      </div>
    </div>
    <div id="background"></div>
    <section>
      <!-- 明治初期 -->
      <era-title id="0">設立</era-title>
      <dl>
        <dt>1871</dt>
        <dd>
          3月、旧加賀藩の砲術師範であった佐野鼎によって開成の前身となる共立学校の「学範」と
          「共立学校規則」が制定された。当時としては珍しく外国人にも通用する正則英語を用いた
          授業を行っていた。
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
      </dl>
    </section>
    <section>
      <!-- 明治後期・大正・昭和初期 -->
      <era-title id="1">「開成」という名称・第二次世界大戦</era-title>
      <dl>
        <dt>1871</dt>
        <dd>
          3月、旧加賀藩の砲術師範であった佐野鼎によって開成の前身となる共立学校の「学範」と
          「共立学校規則」が制定された。当時としては珍しく外国人にも通用する正則英語を用いた
          授業を行っていた。
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
      </dl>
    </section>
    <section>
      <!-- 昭和後期（高度経済成長期）  -->
      <era-title id="2">100周年</era-title>
      <dl>
        <dt>1871</dt>
        <dd>
          3月、旧加賀藩の砲術師範であった佐野鼎によって開成の前身となる共立学校の「学範」と
          「共立学校規則」が制定された。当時としては珍しく外国人にも通用する正則英語を用いた
          授業を行っていた。
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
      </dl>
    </section>
    <section>
      <!-- 平成 -->
      <era-title id="3">現代</era-title>
      <dl>
        <dt>1871</dt>
        <dd>
          3月、旧加賀藩の砲術師範であった佐野鼎によって開成の前身となる共立学校の「学範」と
          「共立学校規則」が制定された。当時としては珍しく外国人にも通用する正則英語を用いた
          授業を行っていた。
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
      </dl>
    </section>
    <section>
      <!-- 未来 -->
      <era-title id="4">これからの「開成」</era-title>
      <dl>
        <dt>1871</dt>
        <dd>
          3月、旧加賀藩の砲術師範であった佐野鼎によって開成の前身となる共立学校の「学範」と
          「共立学校規則」が制定された。当時としては珍しく外国人にも通用する正則英語を用いた
          授業を行っていた。
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
        <dt>1877</dt>
        <dd>
          明治初期の東京は、教育制度の整備が不十分であったこともあり、私立学校が乱立していた。
          そんな中、佐野はコレラに罹患する。共立学校は廃校状態になったが、後に
        </dd>
      </dl>
    </section>
  </main>
</template>

<script>
/**
 * observer で監視する要素と observer の option、intersectionRatio ごとに動かす callback を渡す
 *
 *  vals = {
 *    onDisplay,
 *    oHidden,
 *    targets,
 *    opts
 *  }
 */
/* eslint-disable require-await */
/* eslint-disable */
const aniObserver = async (vals) => {
  const observerCallback = (entries) => {
    entries.forEach((entry) => {
      const classList = entry.target.classList
      if (entry.intersectionRatio > 0) {
        classList.add(vals.className)
        observer.unobserve(entry.target)
      } else {
        classList.remove(vals.className)
      }
    })
  }
  const observer = new IntersectionObserver(observerCallback, vals.opts)
  vals.targets.forEach((elem) => {
    observer.observe(elem)
  })
}
/**
 *  vals = {
 *    paths,
 *    className,
 *    target,
 *    observerTargets,
 *    opts
 *  }
 */
const switchImgs = async (vals) => {
  const backgroundDom = vals.target
  const classList = backgroundDom.classList
  const observerCallback = (entries) => {
    entries.forEach((entry) => {
      const id = Number(entry.target.id)
      const positionY = entry.target.getBoundingClientRect().y
      const viewHeight = document.documentElement.clientHeight
      const toBottom = positionY < 0
      const toTop = positionY < viewHeight / 2
      if (toBottom) {
        console.log("toBottom")
        backgroundDom.style.backgroundImage = `url("../history/${vals.paths[id]}")`
        classList.remove(vals.className)
        console.log(vals.className)
        classList.add(vals.className)
      } else if (toTop) {
        console.log("toTop")
        backgroundDom.style.backgroundImage = `url("../history/${vals.paths[id - 1]}")`
        classList.remove(vals.className)
        classList.add(vals.className)
      } else {
        console.log("other")
      }
    })
  }
  const observer = new IntersectionObserver(observerCallback, vals.opts)
  vals.observeTargets.forEach((elem) => {
    observer.observe(elem)
  })
}
export default {
  data: () => {
    const imgPaths = [
      'establish.jpg',
      'kyouryu.jpg',
      '100th.jpg',
      'latest.jpg',
      'future.jpg',
    ]
    return {
      imgPaths: imgPaths,
    }
  },
  mounted: function () {
    const titleBorders = document.getElementsByClassName('era-title-border')
    // switch images
    const imgsObserverOpts = {
      rootMargin: '0px',
      threshold: 0,
    }
    const backgroundDom = document.getElementById('background')
    const switchImgAniClassName = 'switch-img-animation'
    switchImgs({
      paths: this.$data.imgPaths,
      className: switchImgAniClassName,
      target: backgroundDom,
      observeTargets: titleBorders,
      opts: imgsObserverOpts,
    })
    // border streaching animation
    const borderObserverOpts = {
      rootMargin: '100px',
      threshold: 1.0,
    }
    const borderAniClassName = 'era-title-border-animation'
    aniObserver({
      className: borderAniClassName,
      targets: titleBorders,
      opts: borderObserverOpts,
    })
    // fade-in animation
    const fadeinObserverOpts = {
      rootMargin: '100px',
      threshold: 0,
    }
    const fadeinAniTags = ['h2', 'dd', 'dt']
    const fadeinAniElems = document.querySelectorAll(fadeinAniTags)
    const fadeinAniClassName = 'fadein-animation'
    aniObserver({
      className: fadeinAniClassName,
      targets: fadeinAniElems,
      opts: fadeinObserverOpts,
    })
  },
}
</script>

<style scope>
main {
  padding-bottom: 40px;
  color: white;
  font-weight: 600;
}

section,
#title {
  padding: 0 16px;
  font-family: 'Shippori Mincho';
  margin: 0 auto;
  max-width: 1100px;
}

dl dt {
  font-weight: 800;
  /* mobile */
  margin-top: 28px;
  margin-bottom: 11px;
}

#title {
  padding-bottom: 45px;
  background-color: black;
}

#title-background {
  height: 335px;
  overflow: hidden;
  background-image: url(/icon_large.svg);
  /* mobile */
  background-size: 500px;
  background-clip: margin-box;
  background-position: left 18px top 23px;
}

#title-background p {
  position: absolute;
  top: 295px;
  font-size: 45px;
  font-weight: 700;
  letter-spacing: -0.025em;
}

@media screen and (min-width: 532px) {
  dl {
    display: grid;
    grid-template-columns: 1fr 3fr;
    row-gap: 1em;
  }

  dl dt {
    margin: 0px;
  }

  #title-background {
    background-position: right 18px top 23px;
    background-clip: content-box;
  }
}

section {
  margin-bottom: 100vh;
  background-color: rgba(0, 0, 0, .75);
}

#background {
  margin: 0px;
  padding: 0px;
  width: 100vw;
  height: 100vh;
  background-position: center;
  background-size: cover;
  position: fixed;
  top: 0px;
  z-index: -1;
}

.era-title-border-animation {
  animation-name: era-title-border;
  animation-fill-mode: forwards;
  animation-duration: 0.7s;
  animation-timing-function: ease-out;
}

@keyframes era-title-border {
  0% {
    width: 0px;
  }
  100% {
    width: 100px;
  }
}

.fadein-animation {
  animation-name: fadein;
  animation-fill-mode: forwards;
  animation-duration: 0.7s;
  animation-timing-function: ease-out;
}

@keyframes fadein {
  0% {
    transform: translateY(100px);
    opacity: 0;
  }
  100% {
    transform: translateY(0px);
    opacity: 1;
  }
}
</style>